'use strict';

function drawEntity(context, { image, coords, }, size = 22, color = 'white') {
    context.fillStyle = color;
    context.font = `${size}px serif`;
    context.fillText(image, coords.x, coords.y);
}

const coordsMatch = (p1, p2) => p1.x === p2.x && p1.y === p2.y;
const randomCoords = (max_x, max_y) => ({
    x: (1 - Math.random()) * max_x,
    y: (1 - Math.random()) * max_y
});

class Entity {
    constructor(coords = { x: 0, y: 0 }) {
        this.coords = coords;
    }
    tick() { }
}

class BaseAnimal extends Entity {
    constructor() {
        super(...arguments);
        this.destination = this.coords;
    }
    tick() {
        if (coordsMatch(this.coords, this.destination)) {
            return;
        }
        this.coords.x += (this.destination.x - this.coords.x) > 0 ? this.speed : -this.speed;
        this.coords.y += (this.destination.y - this.coords.y) > 0 ? this.speed : -this.speed;
    }
    move(dest) {
        this.destination = dest;
    }
}

class Rabbit extends BaseAnimal {
    constructor() {
        super(...arguments);
        this.speed = 0.5;
        this.image = '🐇';
    }
}

class Herb extends Entity {
    constructor() {
        super(...arguments);
        this.image = '🌿';
    }
}

class Shamrock extends Entity {
    constructor() {
        super(...arguments);
        this.image = '☘️';
    }
}

class SheafOfRise extends Entity {
    constructor() {
        super(...arguments);
        this.image = '🌾';
    }
}

const canvas = document.querySelector('#canvas');
canvas.height = canvas.clientHeight;
canvas.width = canvas.clientWidth;
const getRandomCoords = () => randomCoords(canvas.width, canvas.height);
const grass = [
    ...Array.from({ length: 20 }).map(() => new SheafOfRise(getRandomCoords())),
    ...Array.from({ length: 20 }).map(() => new Shamrock(getRandomCoords())),
    ...Array.from({ length: 20 }).map(() => new Herb(getRandomCoords())),
];
const animals = [new Rabbit(), new Rabbit(), new Rabbit(), new Rabbit(), new Rabbit(), new Rabbit()];
const entities = [...grass, ...animals];
requestAnimationFrame(draw);
run();
function run() {
    setTimeout(() => {
        animals.forEach((animal) => { animal.move(getRandomCoords()); });
        run();
    }, (1 - Math.random()) * 2000);
}
function draw() {
    const ctx = canvas.getContext('2d');
    ctx.globalCompositeOperation = 'destination-over';
    ctx.clearRect(0, 0, canvas.clientWidth, canvas.clientHeight);
    entities.forEach((entity) => { drawEntity(ctx, entity); });
    animals.forEach((entity) => { entity.tick(); });
    window.requestAnimationFrame(draw);
}
